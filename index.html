<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Household Sale</title>
  <style>
    body { margin:0; font-family:system-ui, Arial, sans-serif; background:#0f1220; color:#e8ecff; }
    .wrap{ max-width:900px; margin:auto; padding:12px; }
    h1{ font-size:20px; margin:12px 0; text-align:center; }

    /* Top note */
    .note {
      background:#222; color:#ffd27f; text-align:center;
      font-weight:500; padding:10px; border-radius:8px; margin-bottom:14px; font-size:14px;
    }

    /* Urgent Banner */
    .banner {
      background: linear-gradient(135deg, #ff4d4d, #cc0000);
      color: #fff;
      text-align: center;
      padding: 20px 14px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.35);
    }
    .banner h2 {
      margin: 0 0 10px;
      font-size: 22px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .banner p {
      margin: 8px 0;
      font-size: 15px;
      line-height: 1.5;
    }
    .banner strong {
      color: #ffd966;
    }

    /* Controls */
    .controls { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .search input, .filter select {
      padding:10px; border-radius:6px; border:1px solid #444; background:#121626; color:#fff; font-size:14px;
    }
    .btn{ padding:10px 16px; border:none; border-radius:6px; cursor:pointer; font-size:14px; }
    .btn.primary{ background:#6aa2ff; color:#000; font-weight:600; }
    .btn.whatsapp{ background:#25D366; color:#fff; width:100%; text-align:center; margin-top:8px; }

    /* Cards */
    .card {
      background:#14182a; border:1px solid #333; border-radius:10px;
      padding:12px; margin-bottom:16px;
    }
    .card h2 { margin:0 0 6px; font-size:16px; }
    .meta { font-size:13px; color:#aaa; margin-bottom:8px; }
    .price { font-size:16px; font-weight:600; margin:6px 0; }
    .status.available { color:#49d49d; font-weight:600; }
    .status.sold { color:#ff6b6b; font-weight:600; }

    /* Galleries with visible scrollbar */
    .gallery {
      display:flex; gap:10px; overflow-x:auto; padding:8px 0;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;        /* Firefox */
      scrollbar-color: #6aa2ff #14182a;
    }
    .gallery::-webkit-scrollbar {
      height: 8px;                  /* scrollbar thickness */
    }
    .gallery::-webkit-scrollbar-track {
      background: #14182a;          /* scrollbar background */
      border-radius: 4px;
    }
    .gallery::-webkit-scrollbar-thumb {
      background: #6aa2ff;          /* scrollbar color */
      border-radius: 4px;
    }
    .gallery iframe {
      width:180px; height:140px; border:none; border-radius:8px;
      flex-shrink:0; background:#000;
    }

    /* Debug */
    .status-box {
      background:#222; color:#eee; padding:8px; margin-top:12px;
      font-family:monospace; white-space:pre-wrap; border-radius:8px; font-size:12px;
    }
    #toggleStatus {
      margin-top:10px; padding:6px 10px; font-size:12px;
      border:none; border-radius:6px; background:#444; color:#fff; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="note">
      üìå Best viewed on a <strong>laptop/desktop</strong>.<br/>
      On mobile: to view photos and videos properly, click on the image ‚Üí swipe up inside it ‚Üí select ‚ÄúAllow Cookies‚Äù ‚Üí then refresh the page.
    </div>

    <div class="banner">
      <h2>üö® Urgent Household Sale ‚Äì Everything Must Go!</h2>
      <p>
        I am <strong>leaving the country</strong> and require 
        <strong>immediate disposal</strong> of all items.<br/>
        Clearance by <strong>end of September</strong> ‚Äì act fast!
      </p>
      <p>
        Items can be inspected at <strong>C-1004 Shanti Vihar</strong><br/>
        (Visit strictly by prior appointment ‚Äì Call <strong>9811238852</strong>)
      </p>
    </div>

    <h1>Available Items</h1>

    <div class="controls">
      <div class="search">
        <input id="searchTerm" type="search" placeholder="Search by Item or Model‚Ä¶" />
        <button id="searchBtn" class="btn primary">Search</button>
      </div>
      <div class="filter">
        <select id="statusFilter">
          <option value="available" selected>Available Only</option>
          <option value="sold">Sold Only</option>
          <option value="all">All</option>
        </select>
      </div>
      <div class="filter">
        <select id="categoryFilter">
          <option value="all" selected>All Categories</option>
        </select>
      </div>
    </div>

    <div id="cards"></div>

    <!-- Debug -->
    <button id="toggleStatus">Hide Debug Info</button>
    <div id="statusBox" class="status-box">Connecting‚Ä¶</div>
  </div>

  <script>
    // ===== CONFIG =====
    const API_KEY  = "AIzaSyCyz2HH1Bdu-OIzitlpPSTZp_Zrn03GfTk";
    const SHEET_ID = "1cMh7HOpOfS9JfSNHiqUC_P945pJEHYp8eKzUoajKBJM";
    const RANGE    = encodeURIComponent("Form Responses 1");

    const SEARCH_COLUMNS = [3,4];
    const CATEGORY_COL = 2;
    const STATUS_COL = 9;
    const PHONE = "9811238852";

    const el = {
      search: document.getElementById("searchTerm"),
      btn: document.getElementById("searchBtn"),
      cards: document.getElementById("cards"),
      statusBox: document.getElementById("statusBox"),
      toggleStatus: document.getElementById("toggleStatus"),
      filter: document.getElementById("statusFilter"),
      categoryFilter: document.getElementById("categoryFilter"),
    };

    let allRows = [];

    function showStatus(msg, type="info") {
      let icon = "‚ÑπÔ∏è"; if(type==="success") icon="‚úÖ"; if(type==="error") icon="‚ùå"; if(type==="warning") icon="‚ö†Ô∏è";
      el.statusBox.textContent = `${icon} ${msg}`;
    }

    async function loadSheet(){
      showStatus("‚è≥ Connecting‚Ä¶");
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const json = await res.json();
        if(res.status !== 200){ showStatus(`‚ùå Failed: ${json.error?.message}`, "error"); return; }
        if(!json.values || json.values.length <= 1){ showStatus("‚ö†Ô∏è No records found.", "warning"); return; }
        allRows = json.values.slice(1);
        populateCategoryDropdown(allRows);
        runSearch();
        showStatus(`‚úÖ Connected! Records: ${allRows.length}`, "success");
      } catch(err){ showStatus("‚ùå Error: "+err.message, "error"); }
    }

    function populateCategoryDropdown(rows){
      const cats = [...new Set(rows.map(r=>(r[CATEGORY_COL]||"").trim()).filter(Boolean))];
      el.categoryFilter.innerHTML = `<option value="all">All Categories</option>`;
      cats.forEach(c=>{
        const opt=document.createElement("option");
        opt.value=c.toLowerCase(); opt.textContent=c;
        el.categoryFilter.appendChild(opt);
      });
    }

    function render(rows){
      el.cards.innerHTML="";
      rows.forEach(r=>{
        const statusVal=(r[STATUS_COL]||"").toLowerCase().trim();
        const isAvailable=statusVal==="yes";
        const itemName=r[3]||""; const model=r[4]||""; const price=r[8]||"";

        const card=document.createElement("div");
        card.className="card";

        card.innerHTML=`
          <h2>${itemName}</h2>
          <div class="meta">${r[2]||""} ‚Ä¢ Model: ${model} ‚Ä¢ Qty: ${r[5]||""}</div>
          <div class="price">‚Çπ${price}</div>
          <div class="status ${isAvailable?"available":"sold"}">${isAvailable?"Available":"Sold"}</div>
        `;

        // Photos
        if(r[6]){
          const photos=document.createElement("div");
          photos.className="gallery";
          r[6].split(",").forEach(u=>{
            const f=document.createElement("iframe");
            f.src=toDrivePreview(u.trim());
            photos.appendChild(f);
          });
          card.appendChild(photos);
        }

        // Videos
        if(r[7]){
          const videos=document.createElement("div");
          videos.className="gallery";
          r[7].split(",").forEach(u=>{
            const f=document.createElement("iframe");
            f.src=toDrivePreview(u.trim()); f.allow="autoplay";
            videos.appendChild(f);
          });
          card.appendChild(videos);
        }

        // WhatsApp button
        if(isAvailable){
          const btn=document.createElement("a");
          btn.className="btn whatsapp";
          btn.href=`https://wa.me/91${PHONE}?text=${encodeURIComponent(`I am interested in this product: ${itemName} (Model: ${model}, Price: ${price})`)}`;
          btn.target="_blank";
          btn.textContent="Contact on WhatsApp";
          card.appendChild(btn);
        }

        el.cards.appendChild(card);
      });
    }

    function toDrivePreview(url){
      if(!url) return "";
      const m=url.match(/\/d\/([^/]+)/)||url.match(/id=([^&]+)/);
      return m && m[1]?`https://drive.google.com/file/d/${m[1]}/preview`:url;
    }

    function runSearch(){
      const q=(el.search.value||"").toLowerCase().trim();
      const f=el.filter.value; const cat=el.categoryFilter.value;
      let filtered=allRows;
      if(q){ filtered=filtered.filter(r=>SEARCH_COLUMNS.some(i=>(r[i]||"").toLowerCase().includes(q))); }
      filtered=filtered.filter(r=>{
        const st=(r[STATUS_COL]||"").toLowerCase().trim();
        if(f==="available") return st==="yes";
        if(f==="sold") return st!=="yes";
        return true;
      });
      if(cat!=="all"){ filtered=filtered.filter(r=>(r[CATEGORY_COL]||"").toLowerCase().trim()===cat); }
      render(filtered);
    }

    el.btn.addEventListener("click", runSearch);
    el.search.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); runSearch(); } });
    el.filter.addEventListener("change", runSearch);
    el.categoryFilter.addEventListener("change", runSearch);

    el.toggleStatus.addEventListener("click", ()=>{
      if(el.statusBox.style.display==="none"){ el.statusBox.style.display="block"; el.toggleStatus.textContent="Hide Debug Info"; }
      else{ el.statusBox.style.display="none"; el.toggleStatus.textContent="Show Debug Info"; }
    });

    loadSheet();
  </script>
</body>
</html>
