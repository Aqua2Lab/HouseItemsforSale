<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Household Sale</title>
  <style>
    body {
      margin:0; font-family:system-ui, Arial, sans-serif;
      background:#0f1220; color:#e8ecff;
      overflow-y:scroll;
    }

    /* Global vertical scrollbar */
    body::-webkit-scrollbar { width:14px; }
    body::-webkit-scrollbar-track { background:#000; }
    body::-webkit-scrollbar-thumb { background:#ffd966; border-radius:8px; }
    body { scrollbar-width:auto; scrollbar-color:#ffd966 #000; }

    .wrap{ max-width:900px; margin:auto; padding:12px; }
    h1{ font-size:20px; margin:12px 0; text-align:center; }

    /* Compact modern Banner */
    .banner {
      background: linear-gradient(90deg, #b30000, #660000);
      color: #fff;
      text-align: center;
      padding: 16px 12px;
      border-radius: 10px;
      margin-bottom: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    }
    .banner h2 {
      margin: 0 0 6px;
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.5px;
    }
    .banner .tagline {
      margin: 4px 0;
      font-size: 14px;
      color: #ffd966;
      font-weight: 500;
    }
    .banner .cta {
      margin: 6px 0;
      font-size: 14px;
      font-weight: 600;
    }
    .whatsapp-tag {
      background:#25D366;
      color:#fff;
      padding:2px 6px;
      border-radius:4px;
      font-size:13px;
    }
    #itemStats {
      margin: 6px 0;
      font-size: 13px;
      font-weight: 500;
    }
    .btn.telegram {
      background:#0088cc; color:#fff; font-weight:600;
      text-decoration:none; padding:8px 14px;
      border-radius:6px; display:inline-block;
      font-size:13px; margin-top:4px;
    }

    /* Controls */
    .controls { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .search input, .filter select {
      padding:10px; border-radius:6px; border:1px solid #444; background:#121626; color:#fff; font-size:14px;
    }
    .btn{ padding:8px 14px; border:none; border-radius:6px; cursor:pointer; font-size:13px; }
    .btn.primary{ background:#6aa2ff; color:#000; font-weight:600; }
    .btn.whatsapp{ background:#25D366; color:#fff; margin-left:10px; white-space:nowrap; }

    /* Cards */
    .card { background:#14182a; border:1px solid #333; border-radius:10px;
      padding:12px; margin-bottom:16px; }
    .card-header { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; }
    .card h2 { margin:0; font-size:16px; }
    .meta { font-size:13px; color:#aaa; margin:6px 0; }
    .price { font-size:16px; font-weight:600; margin:6px 0; }
    .status.available { color:#49d49d; font-weight:600; }
    .status.sold { color:#ff6b6b; font-weight:600; }

    /* Galleries */
    .gallery-wrap { position:relative; margin-top:8px; }
    .gallery {
      display:flex; gap:10px; overflow-x:scroll; overflow-y:hidden; padding:8px 0;
      -webkit-overflow-scrolling: touch;
      scrollbar-width:auto; scrollbar-color:#ffd966 #000;
    }
    .gallery::-webkit-scrollbar { height:12px; }
    .gallery::-webkit-scrollbar-track { background:#000; border-radius:8px; }
    .gallery::-webkit-scrollbar-thumb { background:#ffd966; border-radius:8px; }
    .gallery iframe { width:180px; height:140px; border:none; border-radius:8px; flex-shrink:0; background:#000; }

    /* Gallery arrows */
    .arrow {
      position:absolute; top:50%; transform:translateY(-50%);
      background:rgba(0,0,0,0.7); color:#ffd966;
      border:none; border-radius:50%; width:32px; height:32px;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; z-index:5; font-size:16px;
    }
    .arrow.left { left:-6px; }
    .arrow.right { right:-6px; }

    /* Debug */
    .status-box { background:#222; color:#eee; padding:8px; margin-top:12px;
      font-family:monospace; white-space:pre-wrap; border-radius:8px; font-size:12px; }
    #toggleStatus {
      margin-top:10px; padding:6px 10px; font-size:12px;
      border:none; border-radius:6px; background:#444; color:#fff; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="wrap">

    <!-- Compact Banner -->
    <div class="banner" id="saleBanner">
      <h2>üö® Desperate Sale ‚Äì C-1004 Shanti Vihar</h2>
      <p class="tagline">Leaving the country ‚Äì all items must go in the next few days.</p>
      <p class="cta">
        üí¨ To show interest, click the <span class="whatsapp-tag">WhatsApp</span> button next to each product.
      </p>
      <p id="itemStats">üì¶ Loading item stats‚Ä¶</p>
      <a href="https://t.me/+3jHzpjSWDXZhNjZl" target="_blank" class="btn telegram">
        üëâ Join Telegram Group for Updates
      </a>
    </div>

    <h1>Available Items</h1>

    <div class="controls">
      <div class="search">
        <input id="searchTerm" type="search" placeholder="Search by Item or Model‚Ä¶" />
        <button id="searchBtn" class="btn primary">Search</button>
      </div>
      <div class="filter">
        <select id="statusFilter">
          <option value="available" selected>Available Only</option>
          <option value="sold">Sold Only</option>
          <option value="all">All</option>
        </select>
      </div>
      <div class="filter">
        <select id="categoryFilter">
          <option value="all" selected>All Categories</option>
        </select>
      </div>
    </div>

    <div id="cards"></div>

    <!-- Debug -->
    <button id="toggleStatus">Hide Debug Info</button>
    <div id="statusBox" class="status-box">Connecting‚Ä¶</div>
  </div>

  <script>
    const API_KEY  = "AIzaSyCyz2HH1Bdu-OIzitlpPSTZp_Zrn03GfTk";
    const SHEET_ID = "1cMh7HOpOfS9JfSNHiqUC_P945pJEHYp8eKzUoajKBJM";
    const RANGE    = encodeURIComponent("Form Responses 1");
    const SEARCH_COLUMNS = [3,4];
    const CATEGORY_COL = 2;
    const STATUS_COL = 9;
    const PHONE = "9811238852";

    const el = {
      search: document.getElementById("searchTerm"),
      btn: document.getElementById("searchBtn"),
      cards: document.getElementById("cards"),
      statusBox: document.getElementById("statusBox"),
      toggleStatus: document.getElementById("toggleStatus"),
      filter: document.getElementById("statusFilter"),
      categoryFilter: document.getElementById("categoryFilter"),
    };

    let allRows = [];

    function showStatus(msg, type="info") {
      let icon = "‚ÑπÔ∏è"; if(type==="success") icon="‚úÖ"; if(type==="error") icon="‚ùå"; if(type==="warning") icon="‚ö†Ô∏è";
      el.statusBox.textContent = `${icon} ${msg}`;
    }

    async function loadSheet(){
      showStatus("‚è≥ Connecting‚Ä¶");
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const res = await fetch(url);
        const json = await res.json();
        if(res.status !== 200){ showStatus(`‚ùå Failed: ${json.error?.message}`, "error"); return; }
        if(!json.values || json.values.length <= 1){ showStatus("‚ö†Ô∏è No records found.", "warning"); return; }
        allRows = json.values.slice(1);
        populateCategoryDropdown(allRows);
        updateBannerStats(allRows);
        runSearch();
        showStatus(`‚úÖ Connected! Records: ${allRows.length}`, "success");
      } catch(err){ showStatus("‚ùå Error: "+err.message, "error"); }
    }

    function updateBannerStats(rows){
      let total = rows.length;
      let available = rows.filter(r=>(r[STATUS_COL]||"").toLowerCase().trim()==="yes").length;
      let sold = total - available;
      document.getElementById("itemStats").innerHTML =
        `‚úÖ Available: <strong>${available}</strong> | ‚ùå Sold: <strong>${sold}</strong> | Total: ${total}`;
    }

    function populateCategoryDropdown(rows){
      const cats = [...new Set(rows.map(r=>(r[CATEGORY_COL]||"").trim()).filter(Boolean))];
      el.categoryFilter.innerHTML = `<option value="all">All Categories</option>`;
      cats.forEach(c=>{
        const opt=document.createElement("option");
        opt.value=c.toLowerCase(); opt.textContent=c;
        el.categoryFilter.appendChild(opt);
      });
    }

    function render(rows){
      el.cards.innerHTML="";
      rows.forEach(r=>{
        const statusVal=(r[STATUS_COL]||"").toLowerCase().trim();
        const isAvailable=statusVal==="yes";
        const itemName=r[3]||""; const model=r[4]||""; const price=r[8]||"";

        const card=document.createElement("div");
        card.className="card";

        // Header row: product name + WhatsApp button (if available)
        const header=document.createElement("div");
        header.className="card-header";
        header.innerHTML=`<h2>${itemName}</h2>`;
        if(isAvailable){
          const btn=document.createElement("a");
          btn.className="btn whatsapp";
          btn.href=`https://wa.me/91${PHONE}?text=${encodeURIComponent(`I am interested in this product: ${itemName} (Model: ${model}, Price: ${price})`)}`;
          btn.target="_blank";
          btn.textContent="WhatsApp";
          header.appendChild(btn);
        }
        card.appendChild(header);

        // Other details
        card.innerHTML+=`
          <div class="meta">${r[2]||""} ‚Ä¢ Model: ${model} ‚Ä¢ Qty: ${r[5]||""}</div>
          <div class="price">‚Çπ${price}</div>
          <div class="status ${isAvailable?"available":"sold"}">${isAvailable?"Available":"Sold"}</div>
        `;

        // Photos
        if(r[6]) card.appendChild(makeGallery(r[6].split(","), "photo"));
        // Videos
        if(r[7]) card.appendChild(makeGallery(r[7].split(","), "video"));

        el.cards.appendChild(card);
      });
    }

    function makeGallery(urls, type){
      const wrap=document.createElement("div"); wrap.className="gallery-wrap";
      const gal=document.createElement("div"); gal.className="gallery";
      urls.forEach(u=>{
        const f=document.createElement("iframe");
        f.src=toDrivePreview(u.trim());
        f.allow= type==="video"?"autoplay":"";
        gal.appendChild(f);
      });
      wrap.appendChild(gal);
      const left=document.createElement("button"); left.className="arrow left"; left.innerHTML="‚óÄ";
      const right=document.createElement("button"); right.className="arrow right"; right.innerHTML="‚ñ∂";
      left.onclick=()=>{ gal.scrollBy({left:-200, behavior:"smooth"}); };
      right.onclick=()=>{ gal.scrollBy({left:200, behavior:"smooth"}); };
      wrap.appendChild(left); wrap.appendChild(right);
      return wrap;
    }

    function toDrivePreview(url){
      if(!url) return "";
      const m=url.match(/\/d\/([^/]+)/)||url.match(/id=([^&]+)/);
      return m && m[1]?`https://drive.google.com/file/d/${m[1]}/preview`:url;
    }

    function runSearch(){
      const q=(el.search.value||"").toLowerCase().trim();
      const f=el.filter.value; const cat=el.categoryFilter.value;
      let filtered=allRows;
      if(q){ filtered=filtered.filter(r=>SEARCH_COLUMNS.some(i=>(r[i]||"").toLowerCase().includes(q))); }
      filtered=filtered.filter(r=>{
        const st=(r[STATUS_COL]||"").toLowerCase().trim();
        if(f==="available") return st==="yes";
        if(f==="sold") return st!=="yes";
        return true;
      });
      if(cat!=="all"){ filtered=filtered.filter(r=>(r[CATEGORY_COL]||"").toLowerCase().trim()===cat); }
      render(filtered);
    }

    el.btn.addEventListener("click", runSearch);
    el.search.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); runSearch(); } });
    el.filter.addEventListener("change", runSearch);
    el.categoryFilter.addEventListener("change", runSearch);

    el.toggleStatus.addEventListener("click", ()=>{
      if(el.statusBox.style.display==="none"){ el.statusBox.style.display="block"; el.toggleStatus.textContent="Hide Debug Info"; }
      else{ el.statusBox.style.display="none"; el.toggleStatus.textContent="Show Debug Info"; }
    });

    loadSheet();
  </script>
</body>
</html>
